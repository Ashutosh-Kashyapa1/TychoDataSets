<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Edit TableList</title>
    <!-- Uncomment this line if you have a style.css file -->
    <!-- <link rel="stylesheet" href="style.css"> -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
     body {
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f4f7fc;
    font-family: 'Arial', sans-serif;
    margin: 0;
}

/* Form Container */
.form-container {
    width: 700px; /* Increased width for better field visibility */
    max-height: 90vh; /* Prevents overflow */
    overflow: auto; /* Allows scrolling if needed */
    background: #fff;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

/* Form Heading */
h3 {
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: #333;
    margin-bottom: 20px;
}

/* Form Grid Layout */
.form-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr; /* Two-column layout */
    gap: 15px; /* Space between fields */
}

/* Single Column Full Width */
.form-wrapper .full-width {
    grid-column: span 2;
}

/* Form Field Styling */
.formdesign {
    display: flex;
    flex-direction: column;
}

.formdesign label {
    font-weight: 600;
    margin-bottom: 5px;
    color: #444;
}

.formdesign input {
    width: 100%;
    padding: 10px;
    font-size: 15px;
    border: 1px solid #bbb;
    border-radius: 5px;
    transition: 0.3s ease-in-out;
    background: #f8f8f8;
}

.formdesign input:focus {
    border-color: #472dbb;
    background: #fff;
    outline: none;
    box-shadow: 0 0 5px rgba(71, 45, 187, 0.3);
}

/* Submit Button */
.but {
    display: block;
    width: 200px;
    margin: 20px auto;
    padding: 12px;
    font-size: 16px;
    background: #472dbb;
    color: #fff;
    font-weight: bold;
    text-transform: uppercase;
    border: none;
    border-radius: 6px;
}

    </style>
</head>

<body>
    <div class="form-container">
        <h3>Edit TableList</h3>
        <form name="myForm">

<div class="formdesign">
    <label for="name"><b>name:</b></label>
    <input type="text" name="fname" placeholder="Enter Name" value="<%- response.name %>">
</div>

<div class="formdesign">
    <label for="short_description"><b>short_description:</b></label>
    <input type="text" name="fshort_description" placeholder="Enter Description" value="<%- response.short_description %>">
</div>

<div class="formdesign">
    <label for="semrush_global_rank"><b>semrush_global_rank:</b></label>
    <input type="number" name="fsemrush_global_rank" placeholder="Enter Rank" value="<%- response.semrush_global_rank %>">
</div>

<div class="formdesign">
    <label for="semrush_visits_latest_month"><b>semrush_visits_latest_month:</b></label>
    <input type="number" name="fsemrush_visits_latest_month" placeholder="Enter Visits Count" value="<%- response.semrush_visits_latest_month %>">
</div>

<div class="formdesign">
    <label for="num_investors"><b>num_investors:</b></label>
    <input type="number" name="fnum_investors" placeholder="Enter Number of Investors" value="<%- response.num_investors %>">
</div>

<div class="formdesign">
    <label for="funding_total"><b>funding_total:</b></label>
    <input type="number" name="ffunding_total" placeholder="Enter Funding Total" value="<%- response.funding_total %>">
</div>

<div class="formdesign">
    <label for="num_exits"><b>num_exits:</b></label>
    <input type="text" name="fnum_exits" placeholder="Enter Number of Exits" value="<%- response.num_exits %>">
</div>

<div class="formdesign">
    <label for="num_funding_rounds"><b>num_funding_rounds:</b></label>
    <input type="text" name="fnum_funding_rounds" placeholder="Enter Number of Funding Rounds" value="<%- response.num_funding_rounds %>">
</div>

<div class="formdesign">
    <label for="last_funding_type"><b>last_funding_type:</b></label>
    <input type="text" name="flast_funding_type" placeholder="Enter Last Funding Type" value="<%- response.last_funding_type %>">
</div>
<div class="formdesign">
    <label for="num_acquisitions"><b>num_acquisitions:</b></label>
    <input type="text" name="fnum_acquisitions" placeholder="Enter Number of Acquisitions" value="<%- response.num_acquisitions %>">
</div>
<div class="formdesign">
    <label for="apptopia_total_apps"><b>apptopia_total_apps:</b></label>
    <input type="number" name="apptopia_total_apps" placeholder="Enter apptopia_total_apps" value="<%- response.num_acquisitions %>">
</div>
<div class="formdesign">
    <label for="apptopia_total_downloads"><b>apptopia_total_downloads:</b></label>
    <input type="number" name="apptopia_total_downloads" placeholder="Enter apptopia_total_downloads" value="<%- response.num_acquisitions %>">
</div>

<div class="formdesign">
    <label for="contact_email"><b>contact_email:</b></label>
    <input type="text" name="fcontact_email" placeholder="Enter Email" value="<%- response.contact_email %>">
</div>

<div class="formdesign">
    <label for="phone_number"><b>phone_number:</b></label>
    <input type="text" name="fphone_number" placeholder="Enter Phone Number" value="<%- response.phone_number %>">
</div>

<div class="formdesign">
    <label for="facebook"><b>Facebook:</b></label>
    <input type="text" name="ffacebook" placeholder="Enter Facebook URL" value="<%- response.facebook %>">
</div>

<div class="formdesign">
    <label for="linkedin"><b>LinkedIn:</b></label>
    <input type="text" name="flinkedin" placeholder="Enter LinkedIn URL" value="<%- response.linkedin %>">
</div>

<div class="formdesign">
    <label for="twitter"><b>Twitter:</b></label>
    <input type="text" name="ftwitter" placeholder="Enter Twitter URL" value="<%- response.twitter %>">
</div>
<div class="formdesign">
    <label for=" num_investments"><b> num_investments:</b></label>
    <input type="text" name="fnum_investments" placeholder="Enter  num_investments" value="<%- response. num_investments %>">
</div>
<div class="formdesign">
    <label for="num_lead_investments"><b>num_lead_investments:</b></label>
    <input type="text" name="fnum_lead_investments" placeholder="Enter num_lead_investments" value="<%- response.num_lead_investments %>">
</div>
<div class="formdesign">
    <label for=" num_lead_investors"><b> num_lead_investors:</b></label>
    <input type="text" name="fnum_lead_investors" placeholder="Enter num_lead_investors" value="<%- response.num_lead_investors %>">
</div>
<div class="formdesign">
    <label for="listed_stock_symbol"><b>listed_stock_symbol:</b></label>
    <input type="text" name="flisted_stock_symbol" placeholder="Enter listed_stock_symbol" value="<%- response.listed_stock_symbol %>">
</div>
<div class="formdesign">
    <label for=" company_type"><b> company_type:</b></label>
    <input type="text" name="fcompany_type" placeholder="Enter company_type" value="<%- response.company_type %>">
</div>

<div class="formdesign">
    <label for="hub_tags"><b>hub_tags:</b></label>
    <input type="number" name="fhub_tags" placeholder="Enter hub_tags" value="<%- response.hub_tags %>">
</div>
<div class="formdesign">
    <label for="operating_status"><b>Operating Status:</b></label>
    <input type="text" name="foperating_status" placeholder="Enter Operating Status" value="<%- response.operating_status %>">
</div>

<div class="formdesign">
    <label for="categories"><b>Categories:</b></label>
    <input type="text" name="fcategories" placeholder="Enter Categories" value="<%- response.categories %>">
</div>

<div class="formdesign">
    <label for="founders"><b>Founders:</b></label>
    <input type="text" name="ffounders" placeholder="Enter Founders" value="<%- response.founders %>">
</div>
<div class="formdesign">
    <label for="website"><b>website:</b></label>
    <input type="text" name="fwebsite" placeholder="Enter website" value="<%- response.website %>">
</div>

<div class="formdesign">
    <label for="ipo_status"><b>IPO Status:</b></label>
    <input type="text" name="fipo_status" placeholder="Enter IPO Status" value="<%- response.ipo_status %>">
</div>

<div class="formdesign">
    <label for="num_employees_enum"><b>Number of Employees:</b></label>
    <input type="text" name="fnum_employees_enum" placeholder="Enter Number of Employees" value="<%- response.num_employees_enum %>">
</div>

<div class="formdesign">
    <label for="locations"><b>Locations:</b></label>
    <input type="text" name="flocations" placeholder="Enter Locations" value="<%- response.locations %>">
</div>


<div class="formdesign">
    <label for="growth_insight_description"><b>Growth Insight Description:</b></label>
    <input type="text" name="fgrowth_insight_description" placeholder="Enter Description" value="<%- response.growth_insight_description %>">
</div>

<div class="formdesign">
    <label for="growth_insight_indicator"><b>Growth Insight Indicator:</b></label>
    <input type="text" name="fgrowth_insight_indicator" placeholder="Enter Indicator" value="<%- response.growth_insight_indicator %>">
</div>
<div class="formdesign">
    <label for="growth_insight_direction"><b>Growth Insight Direction:</b></label>
    <input type="text" name="fgrowth_insight_direction" placeholder="Enter Confidence Level" value="<%- response.growth_insight_direction %>">
</div>


<div class="formdesign">
    <label for="growth_insight_confidence"><b>Growth Insight Confidence:</b></label>
    <input type="text" name="fgrowth_insight_confidence" placeholder="Enter Confidence Level" value="<%- response.growth_insight_confidence %>">
</div>

<div class="formdesign">
    <label for="investor_insight_description"><b>Investor Insight Description:</b></label>
    <input type="text" name="finvestor_insight_description" placeholder="Enter Investor Insights" value="<%- response.investor_insight_description %>">
</div>

<div class="formdesign">
    <label for="permalink"><b>Permalink:</b></label>
    <input type="text" name="fpermalink" placeholder="Enter Permalink" value="<%- response.permalink %>">
</div>

<div class="formdesign">
    <label for="url"><b>URL:</b></label>
    <input type="text" name="furl" placeholder="Enter URL" value="<%- response.url %>">
</div>

<button type="button" data-id="<%= response.id %>" class="but">Update</button>
</form>
    </div>
</body>

<script>
 $(document).on("click", ".but", function () {
    const id = $(this).data("id");
    console.log("Update button clicked - ID:", id);

    if (!id) {
        console.error("Error: No ID found on button.");
        Swal.fire({ icon: "error", text: "Invalid item ID." });
        return;
    }

    // Gather form data
    const data = {
        id,
        fcreated_at: $('input[name="fcreated_at"]').val(),
        fname: $('input[name="fname"]').val(),
        fshort_description: $('input[name="fshort_description"]').val(),
        fsemrush_global_rank: $('input[name="fsemrush_global_rank"]').val(),
        fsemrush_visits_latest_month: $('input[name="fsemrush_visits_latest_month"]').val(),
        fnum_investors: $('input[name="fnum_investors"]').val(),
        ffunding_total: $('input[name="ffunding_total"]').val(),
        fnum_exits: $('input[name="fnum_exits"]').val(),
        fnum_funding_rounds: $('input[name="fnum_funding_rounds"]').val(),
        flast_funding_type: $('input[name="flast_funding_type"]').val(),
        flast_funding_at: $('input[name="flast_funding_at"]').val(),
        fnum_acquisitions: $('input[name="fnum_acquisitions"]').val(),
        fapptopia_total_apps: $('input[name="fapptopia_total_apps"]').val(),
        fapptopia_total_downloads: $('input[name="fapptopia_total_downloads"]').val(),
        fcontact_email: $('input[name="fcontact_email"]').val(),
        fphone_number: $('input[name="fphone_number"]').val(),
        ffacebook: $('input[name="ffacebook"]').val(),
        flinkedin: $('input[name="flinkedin"]').val(),
        ftwitter: $('input[name="ftwitter"]').val(),
        fnum_investments: $('input[name="fnum_investments"]').val(),
        fnum_lead_investments: $('input[name="fnum_lead_investments"]').val(),
        fnum_lead_investors: $('input[name="fnum_lead_investors"]').val(),
        flisted_stock_symbol: $('input[name="flisted_stock_symbol"]').val(),
        fcompany_type: $('input[name="fcompany_type"]').val(),
        fhub_tags: $('input[name="fhub_tags"]').val(),
        foperating_status: $('input[name="foperating_status"]').val(),
        ffounded_on: $('input[name="ffounded_on"]').val(),
        fcategories: $('input[name="fcategories"]').val(),
        ffounders: $('input[name="ffounders"]').val(),
        fwebsite: $('input[name="fwebsite"]').val(),
        fipo_status: $('input[name="fipo_status"]').val(),
        fnum_employees_enum: $('input[name="fnum_employees_enum"]').val(),
        flocations: $('input[name="flocations"]').val(),
        fgrowth_insight_description: $('input[name="fgrowth_insight_description"]').val(),
        fgrowth_insight_indicator: $('input[name="fgrowth_insight_indicator"]').val(),
        fgrowth_insight_direction: $('input[name="fgrowth_insight_direction"]').val(),
        fgrowth_insight_confidence: $('input[name="fgrowth_insight_confidence"]').val(),
        finvestor_insight_description: $('input[name="finvestor_insight_description"]').val(),
        fpermalink: $('input[name="fpermalink"]').val(),
        furl: $('input[name="furl"]').val(),
    };

    console.log("Data being sent:", data); // Debugging

    Swal.fire({
        title: "Do you want to update?",
        showCancelButton: true,
        confirmButtonText: "Update",
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
    url: `/update/${id}`,
    type: "PUT", // Use PUT for updates
    data: JSON.stringify(data),
    contentType: "application/json",
    success: function (response) {
        console.log("Server Response:", response);

        if (response.status === "unauthorized") {
            // If session is expired, redirect to login immediately
            window.location.href = "/login";
        } else if (response.status === "success") {
            // Show success message and redirect to /table-view when user clicks OK
            Swal.fire({
                icon: "success",
                text: response.message,
                confirmButtonText: "OK",
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "/table-view";
                }
            });
        } else {
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: response.message,
            });
        }
    },
    error: function (xhr, status, error) {
        console.error("AJAX Error:", status, error, xhr.responseText);
        Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Something went wrong. Please try again later.",
        });
    },
});

        }
    });
});


</script>

</html>
