<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TableList</title>
  
    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
  
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">
  
    <!-- Theme style -->
    <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
  
    <!--  Load jQuery First -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
    <!--  DataTables & Plugins (After jQuery) -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <!-- for sweatler -->
 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }
        .main-sidebar 
        {
          position: fixed !important;
          top: 0;
          left: 0;
          height: 100vh;
          overflow-y: auto;
        }
        .profile-header {
            text-align: center;
            padding-bottom: 20px;
        }
        .profile-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .btn-update {
            margin-top: 20px;
        }
        .email-section {
            margin-top: 40px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 10px;
        }
        .profile-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        }
        .profile-item .form-label {
            width: 100%;
        }
        .custom-width {
        width: 100%; 
        height: auto;
        }    
        .content-header {
        padding: 0px;
        }
        .disabled-input{
          background-color: #f2f2f2;
          color: #888;
          border-radius: 4px;
          cursor: not-allowed;
        }


  </style>
   

  </head>
                        
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
     
      <li class="nav-item">
        <a class="nav-link" data-widget="fullscreen" href="#" role="button">
          <i class="fas fa-expand-arrows-alt"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="#" class="brand-link">
      <!-- <img src="../public/tycho_logo.jpg" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8"> -->
      <span class="brand-text font-weight-light">Tycho DataSets</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item menu-open">
          <li class="nav-item">
            <li class="nav-item">
              <a href="/table-view" class="nav-link">
                <i class="nav-icon fas fa-table"></i>
                <!-- <i class="fas fa-angle-left right"></i> -->
                <!-- <box-icon name='table'></box-icon> -->
                 <p>DataList</p>
              </a>
              
            </li>
            <li class="nav-item">
              <a href="#" id="logout-btn" class="nav-link">
                   <i class="material-icons-outlined me-2">logout</i>
                   <p>LogOut</p>
              </a>
         </li>
            <ul class="nav nav-treeview">
          </li>
            </ul>
          </li>
        
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
    
        
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
       
        <div class="row">
          <div class="col-12">
            <div class="card">
             
            </div>
              <!-- <div class="card">
                </div> -->
                <div class="container mt-5">
                    <div class="profile-container">
                        <div class="employeeDropdown">
                       
                            <form>
                            <div class="row">
                                <div class="col-md-4 profile-item">
                                    <label class="form-label"><strong>Name:</strong></label>
                                    <input type="text" name="fname" class="form-control" id="name" value="<%= response.name %>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="text" class="form-label"><strong>Email:</strong></label>
                                    <input type="text" name="fcontact_email" class="form-control" id="email" value="<%= response.contact_email%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="phone" class="form-label"><strong>Phone:</strong></label>
                                    <input type="text"  name="fphone_number" class="form-control" id="phone" value="<%= response.phone_number%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="facebook" class="form-label"><strong>Facebook:</strong></label>
                                    <input type="text"  name="ffacebook" class="form-control" id="facebook" value="<%= response.facebook%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="twitter" class="form-label"><strong>Twitter:</strong></label>
                                    <input type="text"  name="ftwitter" class="form-control" id="twitter" value="<%= response.twitter%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="linkedin" class="form-label"><strong>LinkedIn:</strong></label>
                                    <input type="text"  name="flinkedin" class="form-control" id="linkedin" value="<%= response.linkedin%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="website" class="form-label"><strong>Website:</strong></label>
                                    <input type="text"  name="fwebsite" class="form-control" id="website" value="<%= response.website%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="status" class="form-label"><strong>Global Rank:</strong></label>
                                    <input type="text"  name="fsemrush_global_rank" class="form-control disabled-input" id="status" value="<%= response.semrush_global_rank%>" disabled >
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="status" class="form-label"><strong>Visits Latest Month:</strong></label>
                                    <input type="text" name="fsemrush_visits_latest_month" class="form-control" id="status" value="<%= response.semrush_visits_latest_month%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="status" class="form-label"><strong>Investors:</strong></label>
                                    <input type="text" name="fnum_investors" class="form-control" id="status" value="<%= response.num_investors%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="status" class="form-label"><strong>Total Funding:</strong></label>
                                    <input type="text" name="ffunding_total" class="form-control" id="status" value="<%= response.funding_total%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="status" class="form-label"><strong>Num Exits:</strong></label>
                                    <input type="text" name="fnum_exits" class="form-control" id="status" value="<%= response.num_exits%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional1" class="form-label"><strong>Funding Rounds:</strong></label>
                                    <input type="text" name="fnum_funding_rounds" class="form-control" id="additional1" value="<%= response.num_funding_rounds%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Last Funding Type:</strong></label>
                                    <input type="text" name="flast_funding_type" class="form-control" id="additional2" value="<%= response.last_funding_type%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Last Funding At:</strong></label>
                                    <input type="text" name="flast_funding_at" class="form-control" id="additional2" value="<%= response.last_funding_at%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Acquisitions:</strong></label>
                                    <input type="text" name="fnum_acquisitions" class="form-control" id="additional2" value="<%= response.num_acquisitions%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Apptopia Total Apps:</strong></label>
                                    <input type="text" name="fapptopia_total_apps" class="form-control" id="additional2" value="<%= response.apptopia_total_apps%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Apptopia Total Downloads:</strong></label>
                                    <input type="text" name="fapptopia_total_downloads" class="form-control" id="additional2" value="<%= response.apptopia_total_downloads%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Num Investments:</strong></label>
                                    <input type="text" name="fnum_investments" class="form-control" id="additional2" value="<%= response.num_investments%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Num Lead Investments:</strong></label>
                                    <input type="text" name="fnum_lead_investments" class="form-control" id="additional2" value="<%= response.num_lead_investments%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Num Lead Investors:</strong></label>
                                    <input type="text" name="fnum_lead_investors" class="form-control" id="additional2" value="<%= response.num_lead_investors%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Listed Stock Symbol:</strong></label>
                                    <input type="text" name="flisted_stock_symbol" class="form-control" id="additional2" value="<%= response.listed_stock_symbol%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Company Type:</strong></label>
                                    <input type="text" name="fcompany_type" class="form-control" id="additional2" value="<%= response.company_type%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Hub Tags:</strong></label>
                                    <input type="text" name="fhub_tags" class="form-control" id="additional2" value="<%= response.hub_tags%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Operating Status:</strong></label>
                                    <input type="text" name="foperating_status" class="form-control" id="additional2" value="<%= response.operating_status%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Founded On:</strong></label>
                                    <input type="text" name="ffounded_on" class="form-control disabled-input" id="additional2" value="<%= response.founded_on%>" disabled>
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Categories:</strong></label>
                                    <input type="text" name="fcategories" class="form-control" id="additional2" value="<%= response.categories%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Founders:</strong></label>
                                    <input type="text" name="ffounders" class="form-control" id="additional2" value="<%= response.founders%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>IPO Status:</strong></label>
                                    <input type="text" name="fipo_status"class="form-control" id="additional2" value="<%= response.ipo_status%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Num Employees Enum:</strong></label>
                                    <input type="text" name="fnum_employees_enum" class="form-control" id="additional2" value="<%= response.num_employees_enum%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Locations:</strong></label>
                                    <input type="text" name="flocations" class="form-control" id="additional2" value="<%= response.locations%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Growth Insight Description:</strong></label>
                                    <input type="text" name="fgrowth_insight_description" class="form-control" id="additional2" value="<%= response.growth_insight_description%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Growth Insight Indicator:</strong></label>
                                    <input type="text" name="fgrowth_insight_indicator" class="form-control" id="additional2" value="<%= response.growth_insight_indicator%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Growth Insight Direction:</strong></label>
                                    <input type="text" name="fgrowth_insight_direction" class="form-control" id="additional2" value="<%= response.growth_insight_direction%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Growth Insight Confidence:</strong></label>
                                    <input type="text" name="fgrowth_insight_confidence" class="form-control" id="additional2" value="<%= response.growth_insight_confidence%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Investor Insight Description:</strong></label>
                                    <input type="text" name="finvestor_insight_description" class="form-control" id="additional2" value="<%= response.investor_insight_description%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Permalink:</strong></label>
                                    <input type="text" name="fpermalink" class="form-control" id="additional2" value="<%= response.permalink%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Results URL:</strong></label>
                                    <input type="text" name="furl" class="form-control" id="additional2" value="<%= response.url%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Created At:</strong></label>
                                    <input type="text"  name="fcreated_at" class="form-control disabled-input" id="additional2" value="<%= response.createdAt%>" disabled>
                                </div>

                                <div class="col-md-12 profile-item"></div>
                                    <label for="additional2"  class="form-label"><b>Description:</b></label>
                                    <input type="text" name="fshort_description" class="form-control" id="additional2" placeholder="Enter Description" value="<%= response.short_description %>">
                                </div>
                                
                                
                            </div>
                            <button type="button" data-id="<%= response.id %>" class="btn btn-primary btn-update">Update</button>
                        </form>
                                          
                       
                        <!-- Email Section -->
                        <div class="email-section">
              
                          <h4>Send an Email.</h4>
                      <form id="emailForm" enctype="multipart/form-data">
                          <div class="mb-3">
                              <label for="fromEmail" class="form-label">From:</label>
                              <input type="email" name="ffremail" class="form-control" id="fromEmail" value="bhutobhawisyati@gmail.com" readonly>
                          </div>
                          <div class="mb-3">
                              <label for="toEmail" class="form-label">To:</label>
                              <input type="email" name="ftoemail" class="form-control" id="toEmail" placeholder="Enter recipient email" value="<%= response.contact_email %>">
                          </div>
                          <div class="mb-3">
                              <label for="ccEmail" class="form-label">CC:</label>
                              <input type="text" name="fccemail" class="form-control" id="ccEmail" placeholder="Enter CC email">
                          </div>
                          <div class="mb-3">
                              <label for="subject" class="form-label">Subject:</label>
                              <input type="text" name="fsubject" class="form-control" id="subject" placeholder="Enter subject">
                          </div>
                          <div class="mb-3">
                              <label for="editor" class="form-label">Message:</label>
                              <div id="editor" style="height: 200px;"></div>
                              <input type="hidden" name="ftextarea" id="hiddenMessage">
                          </div>
                          <div id="loading" style="display: none; text-align: center;">
                            <img src="/loading.gif?v=1" alt="Loading...">
                            <p>Sending Email...</p>
                        </div>
                          <div class="mb-3">
                              <label for="fileAttachment" class="form-label">Attachment:</label>
                              <input type="file" name="attachment" class="form-control" id="fileAttachment">
                          </div>
                          <button type="submit" class="btnsss btn-success">Send Email</button>
                      </form>
                    </div>
                        </div>   
                    </div>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  
  <!-- /.content-wrapper -->
  <footer class="main-footer" style="text-align: center; justify-content: center;">
    <strong>Copyright &copy; 2025-2035 <a href="https://tychotechnologies.com/">tychotechnologies</a>.</strong>
    All rights reserved.
  </footer>
  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="../../plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables  & Plugins -->
<script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="../../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="../../plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<script src="../../plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
<script src="../../plugins/jszip/jszip.min.js"></script>
<script src="../../plugins/pdfmake/pdfmake.min.js"></script>
<script src="../../plugins/pdfmake/vfs_fonts.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.print.min.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>
<!-- Page specific script -->
  
</body>

<script>
    $(document).on("click", ".btn", function () {
       const id = $(this).data("id");
       console.log("Update button clicked - ID:", id);
   
       if (!id) {
           console.error("Error: No ID found on button.");
           Swal.fire({ icon: "error", text: "Invalid item ID." });
           return;
       }
   
       // Gather form data
       const data = {
           id,
           fcreated_at: $('input[name="fcreated_at"]').val(),
           fname: $('input[name="fname"]').val(),
           fshort_description: $('input[name="fshort_description"]').val(),
           fsemrush_global_rank: $('input[name="fsemrush_global_rank"]').val(),
           fsemrush_visits_latest_month: $('input[name="fsemrush_visits_latest_month"]').val(),
           fnum_investors: $('input[name="fnum_investors"]').val(),
           ffunding_total: $('input[name="ffunding_total"]').val(),
           fnum_exits: $('input[name="fnum_exits"]').val(),
           fnum_funding_rounds: $('input[name="fnum_funding_rounds"]').val(),
           flast_funding_type: $('input[name="flast_funding_type"]').val(),
           flast_funding_at: $('input[name="flast_funding_at"]').val(),
           fnum_acquisitions: $('input[name="fnum_acquisitions"]').val(),
           fapptopia_total_apps: $('input[name="fapptopia_total_apps"]').val(),
           fapptopia_total_downloads: $('input[name="fapptopia_total_downloads"]').val(),
           fcontact_email: $('input[name="fcontact_email"]').val(),
           fphone_number: $('input[name="fphone_number"]').val(),
           ffacebook: $('input[name="ffacebook"]').val(),
           flinkedin: $('input[name="flinkedin"]').val(),
           ftwitter: $('input[name="ftwitter"]').val(),
           fnum_investments: $('input[name="fnum_investments"]').val(),
           fnum_lead_investments: $('input[name="fnum_lead_investments"]').val(),
           fnum_lead_investors: $('input[name="fnum_lead_investors"]').val(),
           flisted_stock_symbol: $('input[name="flisted_stock_symbol"]').val(),
           fcompany_type: $('input[name="fcompany_type"]').val(),
           fhub_tags: $('input[name="fhub_tags"]').val(),
           foperating_status: $('input[name="foperating_status"]').val(),
           ffounded_on: $('input[name="ffounded_on"]').val(),
           fcategories: $('input[name="fcategories"]').val(),
           ffounders: $('input[name="ffounders"]').val(),
           fwebsite: $('input[name="fwebsite"]').val(),
           fipo_status: $('input[name="fipo_status"]').val(),
           fnum_employees_enum: $('input[name="fnum_employees_enum"]').val(),
           flocations: $('input[name="flocations"]').val(),
           fgrowth_insight_description: $('input[name="fgrowth_insight_description"]').val(),
           fgrowth_insight_indicator: $('input[name="fgrowth_insight_indicator"]').val(),
           fgrowth_insight_direction: $('input[name="fgrowth_insight_direction"]').val(),
           fgrowth_insight_confidence: $('input[name="fgrowth_insight_confidence"]').val(),
           finvestor_insight_description: $('input[name="finvestor_insight_description"]').val(),
           fpermalink: $('input[name="fpermalink"]').val(),
           furl: $('input[name="furl"]').val(),
       };
   
       console.log("Data being sent:", data); // Debugging
   
       Swal.fire({
           title: "Do you want to update?",
           showCancelButton: true,
           confirmButtonText: "Update",
       }).then((result) => {
           if (result.isConfirmed) {
               $.ajax({
       url: `/update/${id}`,
       type: "PUT", // Use PUT for updates
       data: JSON.stringify(data),
       contentType: "application/json",
       success: function (response) {
           console.log("Server Response:", response);
   
           if (response.status === "unauthorized") {
               // If session is expired, redirect to login immediately
               window.location.href = "/login";
           } else if (response.status === "success") {
               // Show success message and redirect to /table-view when user clicks OK
               Swal.fire({
                   icon: "success",
                   text: response.message,
                   confirmButtonText: "OK",
               }).then((result) => {
                   if (result.isConfirmed) {
                       window.location.href = "/table-view";
                   }
               });
           } else {
               Swal.fire({
                   icon: "error",
                   title: "Oops...",
                   text: response.message,
               });
           }
       },
       error: function (xhr, status, error) {
           console.error("AJAX Error:", status, error, xhr.responseText);
           Swal.fire({
               icon: "error",
               title: "Oops...",
               text: "Something went wrong. Please try again later.",
           });
       },
   });
   
           }
       });
   });
   
   
   </script>
 
 <script>
  // Initialize Quill editor
  var quill = new Quill('#editor', {
    theme: 'snow',
    readOnly: false,
    placeholder: 'Enter message...',
    modules: {
      toolbar: [
        [{ 'font': [] }, { 'size': [] }],
        ['bold', 'italic', 'underline', 'strike'],
        [{ 'color': [] }, { 'background': [] }],
        [{ 'align': [] }],
        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
        ['clean']
      ]
    }
  });

  $(document).on("click", ".btnsss", function (e) {
    e.preventDefault();

    // Get Quill content as HTML
    let messageHtml = quill.root.innerHTML;
    $("#hiddenMessage").val(messageHtml);

    Swal.fire({
      title: "Are you sure?",
      text: "This action cannot be undone!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Send",
      cancelButtonText: "Cancel"
    }).then((result) => {
      if (result.isConfirmed) {
        $("#loading").show(); // LOADER को दिखाओ
        $(".btnsss").prop("disabled", true);

        setTimeout(() => {
          let formData = new FormData();
          formData.append("ffremail", $("input[name='ffremail']").val());
          formData.append("ftoemail", $("input[name='ftoemail']").val());
          formData.append("fccemail", $("input[name='fccemail']").val());
          formData.append("fsubject", $("input[name='fsubject']").val());
          formData.append("ftextarea", quill.root.innerHTML);

          let fileInput = $("input[name='attachment']")[0].files[0];
          if (fileInput) {
            formData.append("attachment", fileInput);
          }

          $.ajax({
            url: "/sendEmail",
            type: "POST",
            data: formData,
            contentType: false,
            processData: false,
            success: function (data) {
              setTimeout(() => { // LOADER हटाने से पहले थोड़ा रुकने का टाइम दो
                $("#loading").hide();
                $(".btnsss").prop("disabled", false);
                Swal.fire({ icon: "success", text: "Email sent successfully!" });
                setTimeout(() => location.reload(), 1000);
              }, 500);
            },
            error: function () {
              setTimeout(() => {
                Swal.fire({ icon: "error", title: "Oops...", text: "Something went wrong." });
                $("#loading").hide();
                $(".btnsss").prop("disabled", false);
              }, 500);
            }
          });
        }, 100); 
      }
    });
  });
</script>
<script>


</script>


</html>
